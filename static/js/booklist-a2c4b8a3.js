import{s as G,a as K,d as Y,t as Z,u as q,v as ee,w as oe,x as te,y as ae,z as se,E as z}from"./element-plus-d03682ba.js";import{b as ne,u as le,o as re}from"./vue-router-cfababd1.js";import{_ as ie}from"./lodash-86c374ca.js";import{_ as ce}from"./SearchBox.vue_vue_type_style_index_0_lang-a5948eb2.js";import{g as pe,a as de}from"./book-bf9a29d9.js";import{a as _e}from"./order-b56e68b7.js";import{a as ue,r as me}from"./favorites-b27948cc.js";import{J as ge,e as h,a0 as he,i as fe,ag as f,o as l,c as p,X as a,u as n,R as r,V as d,F as v,a6 as x,Q as B,a as t,W as i,U as ve,S as be}from"./@vue-7143f52f.js";import"./lodash-es-6689e95d.js";import"./@vueuse-71394f68.js";import"./@element-plus-b2faaa35.js";import"./@popperjs-c75af06c.js";import"./@ctrl-43a4208a.js";import"./dayjs-904a9561.js";import"./@kangc-6605a7f7.js";import"./vue-58b885c9.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-b3b4f581.js";import"./index-f9d2d8f9.js";import"./vuex-af3025ab.js";import"./axios-6667cfca.js";import"./form-data-d2a9677b.js";const ke={key:0,class:"breadcrumb"},Ce={underline:!1,class:"el-dropdown-link"},we={class:"list-product"},ye={key:1,underline:!1,class:"el-dropdown-link"},Se={class:"total"},ze={style:{color:"dodgerblue"}},xe={class:"goods-list"},Be=["src"],Ee={class:"price"},Fe={class:"price-n"},Ve={class:"price-r"},Le={class:"price-s"},Ne={class:"name"},$e={class:"publisher"},je={class:"publisher"},Ue=["title"],Ie={class:"star"},Re=t("div",{class:"placer"},null,-1),Te={class:"bottom"},De={class:"shop-button"},Me=["onClick"],Oe=["onClick"],Pe={class:"pagination"},fo=ge({__name:"booklist",setup(He){const E=ne(),F=le(),N=h(null);h(!1);const _=h(null),c=he({page:0,pages:0,total:0,pageSize:0,items:[]}),k={},u=h([]),C=h(!0),V=async e=>{C.value=!0;const s=e.page?Number.parseInt(e.page):1,m=Number.parseInt(e.pageSize??"20");Object.assign(k,{keyword:e.keyword??"",name:e.name??"",author:e.author??"",publisher:e.publisher??"",desc:e.desc??""}),u.value=(e.categories??"1").split(".").map(y=>Number.parseInt(y)),Object.assign(c,await de(s,m,k,u.value.at(-1))),C.value=!1};fe(async()=>{_.value=await pe(),await V(E.query)}),re(async e=>await V(e.query));const w=async(e,s)=>{const m=ie.pickBy({page:e,pageSize:s,...k,categories:u.value.join(".")});F.push({name:E.name,query:m})},$=async e=>{const s=await _e(e,1);z.success(s.message)},j=async e=>{if(e.favorite){const s=await me([e.bid]);z.success(s.message),e.favorite=!1}else{const s=await ue(e.bid);z.success(s.message),e.favorite=!0}},U=async e=>await w(1,e),I=async e=>await w(e,c.pageSize),R=async(e,s)=>{e+1<u.value.length&&u.value.splice(e+1),u.value[e+1]=s,w(1,c.pageSize)};return(e,s)=>{const m=G,y=f("arrow-down"),b=K,L=Y,T=Z,D=q,M=ee,O=f("router-link"),P=oe,H=f("ShoppingCart"),J=f("StarFilled"),Q=f("Star"),W=te,X=ae,A=se;return l(),p("div",null,[a(ce,{ref_key:"searchBox",ref:N},null,512),n(_)?(l(),p("div",ke,[a(M,{separator:"/"},{default:r(()=>[a(m,null,{default:r(()=>[d("全部")]),_:1}),(l(!0),p(v,null,x(n(u),(o,g)=>(l(),B(m,{key:o},{default:r(()=>[n(_).all[o].children_id.length>0?(l(),B(D,{key:0,placement:"bottom-start"},{dropdown:r(()=>[a(T,null,{default:r(()=>[t("div",we,[(l(!0),p(v,null,x(n(_).all[o].children_id,S=>(l(),B(L,{key:S,underline:!1,onClick:Je=>R(g,S)},{default:r(()=>[d(i(n(_).all[S].name),1)]),_:2},1032,["onClick"]))),128))])]),_:2},1024)]),default:r(()=>[t("span",Ce,[d(i(n(_).all[o].name)+" ",1),a(b,{class:"el-icon--right"},{default:r(()=>[a(y)]),_:1})])]),_:2},1024)):(l(),p("span",ye,i(n(_).all[o].name),1))]),_:2},1024))),128))]),_:1}),t("span",Se,[d(" 共 "),t("span",ze,i(n(c).total),1),d(" 件商品 ")])])):ve("",!0),be((l(),p("div",xe,[(l(!0),p(v,null,x(n(c).items,o=>(l(),p("div",{key:o.bid,class:"goods-item"},[a(O,{to:{name:"bookdetail",params:{bid:o.bid}}},{default:r(()=>[t("img",{class:"pic",src:o.cover},null,8,Be)]),_:2},1032,["to"]),t("p",Ee,[t("span",Fe," ￥"+i(o.price.toFixed(2)),1),t("span",Ve,[d(" 定价： "),t("span",null,"￥"+i(o.originalPrice.toFixed(2)),1)]),t("span",Le,"("+i((o.price/o.originalPrice).toFixed(2))+"折)",1)]),t("p",Ne,[a(L,{title:o.name,onClick:g=>n(F).push({name:"bookdetail",params:{bid:o.bid}})},{default:r(()=>[d(i(o.name),1)]),_:2},1032,["title","onClick"])]),t("p",$e,i(o.author),1),t("p",je,i(o.publisher),1),t("p",{class:"search-hot-word",title:o.desc},i(o.desc),9,Ue),t("p",Ie,[a(P,{modelValue:o.rating,"onUpdate:modelValue":g=>o.rating=g,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),t("span",null,i(o.numComments)+"条评论",1)]),Re,t("div",Te,[t("div",De,[t("a",{onClick:g=>$(o.bid),href:"javascript:void(0);"},[a(b,null,{default:r(()=>[a(H)]),_:1}),d(" 加入购物车 ")],8,Me),t("a",{onClick:g=>j(o),href:"javascript:void(0);"},[o.favorite?(l(),p(v,{key:0},[a(b,null,{default:r(()=>[a(J)]),_:1}),d(" 已收藏 ")],64)):(l(),p(v,{key:1},[a(b,null,{default:r(()=>[a(Q)]),_:1}),d(" 收藏 ")],64))],8,Oe)])])]))),128))])),[[A,n(C)]]),t("div",Pe,[a(W,{"current-page":n(c).page,"onUpdate:current-page":s[0]||(s[0]=o=>n(c).page=o),"page-size":n(c).pageSize,"onUpdate:page-size":s[1]||(s[1]=o=>n(c).pageSize=o),"page-sizes":[20,50,100,200],small:"",background:"",layout:"->, total, sizes, prev, pager, next, jumper, ->",total:n(c).total,onSizeChange:U,onCurrentChange:I},null,8,["current-page","page-size","total"])]),a(X,{right:100,bottom:100})])}}});export{fo as default};
